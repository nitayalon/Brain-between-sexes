---
title: "Testing MLE and Likelihood over mixture and pure type population"
author: "Nitay Alon"
date: "June 12, 2018"
output: html_document
---
In this report we examine three things - the log likelihood ratio between men and women distribution, the shape of the log likelihood over the parameter set and the MLE over the null hypothesis.
```{r Loading the data, cache=FALSE, include=FALSE}
library(plotly)
setwd("~/mastersdegree/Thesis/DAPHNA_JOEL/Results/Reports/")
source("~/mastersdegree/Thesis/DAPHNA_JOEL/Grid_search/source_script_grid_search.R")
llk_breaks <- seq(0,6,length.out = 100)
pvalue_breaks <- seq(0,1,length.out = 50)
```
##Log Likelihood Ratio
We examine the llk ratio between men and women:
\[
\frac{l(x|Theta)}{l(y|Theta)}
\]
First for pure typed:
\[
f(x|\Theta) \sim \mathcal{N}(\mu_{masculine}, \sigma^2) \\
f(y|\Theta) \sim \mathcal{N}(\mu_{feminine}, \sigma^2)
\]
Sample observation:
```{r}
mu_mas <- 0.2
mu_fem <- -mu_mas
p <- 1; q <- 0
n <- 1e5
sigma_2 <- 0.98
pop <- sampleMockData(mu_mas, mu_fem,p,q,sigma_2,n)
normalized_pop <- normalizingData(pop$men, pop$women)
validateSample(normalized_pop$men, normalized_pop$women)
hist(normalized_pop$men, breaks = 100, col = "blue")
hist(normalized_pop$women, breaks = 100, col = "red", add = T)
```
We begin with estimation of MLE under the null hypothesis:
```{r}
MLE_under_null_hypothesis <- computeMLEOverGridMockData(normalized_pop)
H1 <- computeLogLikelihoodForFeature(men_feature_data = normalized_pop$men, women_feature_data = normalized_pop$women, 
                                     theta_2 = MLE_under_null_hypothesis$Theta2, 
                                     theta_1 = MLE_under_null_hypothesis$Theta1,
                                     p = MLE_under_null_hypothesis$p,
                                     q = MLE_under_null_hypothesis$q, 
                                     sigma_2_mas = MLE_under_null_hypothesis$Sigma2,
                                     sigma_2_fem = MLE_under_null_hypothesis$Sigma2
                                     )
men_mean <- mean(normalized_pop$men)
women_mean <- mean(normalized_pop$women)
H0 <- computeLlkNullHypothesis(men_mean, men_feature_data = normalized_pop$men,  women_feature_data = normalized_pop$women)
```
Ploting the LLK over the set of parameters:
```{r}
llk <- computeLogLikelihoodOverGridMockData(normalized_pop)
inf_ind <- which(llk$llk != -Inf)
p_theta <- plot_ly(x = llk[inf_ind,]$Theta2,
               y = llk[inf_ind,]$Theta1,
               z = -llk[inf_ind,]$llk,
               type = "contour")
p_theta
```

